// Ghost Â© 2013-2014 Andrey Polischuk
// https://github.com/andrepolischuk/ghost
!function(){"use strict";function Ghost(options){function getVariables(){for(var e,a={},b=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),c=0,d=b.length;d>c;c++)e=b[c].split("="),/^utm/gi.test(e[0])&&(a[e[0]]=e[1]);return c in a?a:void 0}function getSearch(){var c,d,e,f,a=decodeURIComponent(document.referrer),b=a.slice(a.indexOf("?")+1).split("&"),g={"a.ua":"s","akavita.by":"z","all.by":"query","aport.ru":"r","bigmir.net":"q",bing:"q,","gde.ru":"keywords","go.mail.ru":"q","gogo.ru":"q",google:"q","i.ua":"q","km.ru":"sq","liveinternet.ru":"ask",lycos:"q","meta.ua":"q,",msn:"q","nigma.ru":"s","online.ua":"q","poisk.ru":"text","quintura.ru":"request",rambler:"query","search.com.ua":"q","search.qip.ru":"query,","search.ua":"query","search.ukr.net":"search_query","tut.by":"query","ukr.net":"search_query","webalta.ru":"q",yahoo:"p",yandex:"text"};if(a.length<=0)return!1;for(c in g)if(g.hasOwnProperty(c)){var h=new RegExp(c+".*\\?","i");h.test(a)&&(f=g[c])}if(!f)return!1;for(c=0,d=b.length;d>c;c+=1)if(e=b[c].split("="),e[0]===f)return e[1]}function getDate(){var a=new Date,b=(a.getDate()<10?"0":"")+a.getDate()+"."+(a.getMonth()<10?"0":"")+(a.getMonth()+1)+"."+a.getFullYear(),c=(a.getHours()<10?"0":"")+a.getHours()+":"+(a.getMinutes()<10?"0":"")+a.getMinutes(),d=a.getTimezoneOffset()/60,e=a.getTimezoneOffset()%60/60,f="UTC"+(d>0?"-":"+")+(d-e+(0!==e?":"+60*e:"")).replace(/-?/i,"");return[b,c,f]}function getScreen(){var a=!1,b=!1;if(parseInt(navigator.appVersion)>3)a=screen.width,b=screen.height;else if("Netscape"===navigator.appName&&3===parseInt(navigator.appVersion)&&navigator.javaEnabled()){var c=java.awt.Toolkit.getDefaultToolkit(),d=c.getScreenSize();a=d.width,b=d.height}return a+"x"+b}function getOS(){var a,b=window.navigator.userAgent,c=/Windows/i,d=/Windows\sNT\s6\.2/i,e=/Windows\sNT\s6\.1/i,f=/Windows\sNT\s6\.0/i,g=/Windows\sNT\s5\.2/i,h=/Windows\sNT\s5\.1/i,i=/Windows\sNT\s5\.0/i,j=/Win\s9x\s4\.90/i,k=/Win98/i,l=/Win95/i,m=/WinNT4\.0/i,n=/Win3\.11/i,o=/Windows.*CE/i,p=/.*Windows\sPhone\sOS\s(\d\.\d).*/i,q=/Windows\sMobile/i,r=/(Mac\sOS|Macintosh|Mac)/i,s=/.*Mac\sOS\sX\s(\d+).(\d+).(\d*).*/i,t=/(iPhone|iPad|iPod)/i,u=/.*OS\s(\d+).(\d+).(\d*).*/i,v=/Android/i,w=/.*Android\s(\d+).(\d+).(\d*).*/i,x=/BlackBerry/i,y=/.*BlackBerry\s(\d+).*/i,z=/SymbOS/i,A=/Linux/i;return a=t.test(b)?u.test(b)?["iOS",b.replace(u,"$1.$2")]:["iOS","undefined"]:v.test(b)?w.test(b)?["Android",b.replace(w,"$1.$2")]:["Android","undefined"]:x.test(b)?y.test(b)?["BlackBerry",b.replace(y,"$1")]:["BlackBerry","undefined"]:z.test(b)?["Symbian OS","undefined"]:c.test(b)?d.test(b)?["Windows","8"]:e.test(b)?["Windows","7"]:f.test(b)?["Windows","Vista"]:g.test(b)?["Windows","Server 2003"]:h.test(b)?["Windows","XP"]:i.test(b)?["Windows","2000"]:j.test(b)?["Windows","ME"]:k.test(b)?["Windows","98"]:l.test(b)?["Windows","95"]:m.test(b)?["Windows","NT 4.0"]:n.test(b)?["Windows","3.11"]:o.test(b)?["Windows","CE"]:p.test(b)?["Windows",b.replace(p,"Phone $1")]:q.test(b)?["Windows","Mobile"]:["Windows","undefined"]:r.test(b)?s.test(b)?["Mac OS X",b.replace(s,"$1.$2")]:["Mac OS","undefined"]:A.test(b)?["Linux","undefined"]:["undefined","undefined"]}function getAppByNavigator(a){var b,c=window.navigator.userAgent,d=/Opera[ \/]+\w+\.\w+/i,e=/Version[ \/]+\w+\.\w+/i,f=/Firefox\/\w+\.\w+/i,g=/Chrome\/\w+\.\w+/i,h=/Version\/\w+\.\w+/i,i=/MSIE *\d+\.\w+/i,j=/Safari\/\w+\.\w+/i,k=[],l=/[ \/\.]/i,m=c.match(f),n=c.match(g),o=c.match(h),p=c.match(i),q=c.match(d);return e=c.match(e),j=c.match(j),null!==q&&null!==e?k.push(e[0].replace(/Version/,"Opera")):null!==q?k.push(q[0]):null!==p?k.push(p[0]):null!==m?k.push(m[0]):null!==n?k.push(n[0]):null!==o&&null!==j&&k.push(o[0].replace("Version","Safari")),null!==k[0]&&(b=k[0].split(l)),null!==a&&0!==a||null===b?null!==a?(b[2]=b[2].substr(0,a),b):void 0:(a=b[2].length,b[2]=b[2].substring(0,a),b)}function getAppByJs(){var a=[];return window.opera?(a.push("Opera"),a.push(window.opera.version())):window.chrome?a.push("Chrome"):window.sidebar?a.push("Firefox"):window.external||"Opera"===a[0]?window.ActiveXObject&&(a.push("MSIE"),window.navigator.userProfile?a.push("6"):window.Storage?a.push("8"):window.Storage||window.navigator.userProfile?a.push("Unknown"):a.push("7")):a.push("Safari"),a?a:void 0}function getApp(a){var b=getAppByNavigator(a),c=getAppByJs();return b[0]===c[0]?b:b[0]!==c[0]?c:void 0}function createRequest(){var a;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){}try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}return a}function send(path,params,callback){req.connector=req.connector||createRequest(),req.connector&&(req.connector.open("GET",path+(/\?/.test(path)?"&":"?")+params,!0),req.connector.onreadystatechange=function(){try{if(4===req.connector.readyState&&200===req.connector.status){var rData=req.connector.responseText,eData=!/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(rData.replace(/"(\\.|[^"\\])*"/g,""))&&eval("("+rData+")");"function"==typeof callback&&callback(new Object(eData))}}catch(e){}},req.connector.send(null))}function cookie(a,b,c){if("undefined"==typeof b){var i=null;if(document.cookie&&""!==document.cookie)for(var j=document.cookie.split(";"),k=0;k<j.length;k++){var l=j[k].replace(/^(\s|\u00A0)+/g,"");if(l.substring(0,a.length+1)===a+"="){i=decodeURIComponent(l.substring(a.length+1));break}}return i}c=c||{},null===b&&(b="",c.expires=-1);var d="";if(c.expires&&("number"==typeof c.expires||c.expires.toUTCString)){var e;"number"==typeof c.expires?(e=new Date,e.setTime(e.getTime()+1e3*60*60*24*c.expires)):e=c.expires,d="; expires="+e.toUTCString()}var f=c.path?"; path="+c.path:"",g=c.domain?"; domain="+c.domain:"",h=c.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),d,f,g,h].join("")}var req={};req.array={},req.string="",req.path=options.path||"",req.connector=null,this.push=function(a){var b=decodeURIComponent(document.referrer)||null,c=getSearch()||null,d=getVariables()||null,e=getApp(1),f=getOS(),g=getDate();if(req.array.pageUrl=decodeURIComponent(window.location.href),b&&(req.array.pageRef=b),c&&(req.array.pageQ=c),document.cookie&&""!==document.cookie&&(req.array.pageCc=document.cookie.replace(/(\s|\u00A0)+/g,"")),d)for(var h in d)d.hasOwnProperty(h)&&(req.array.pageVars[h]=d[h]);req.array.appName=e[0],req.array.appVers=parseFloat(e[1]+"."+e[2])||"undefined",req.array.appLang=(navigator.language||navigator.systemLanguage||navigator.userLanguage).substr(0,2).toLowerCase(),req.array.osName=f[0],req.array.osVers=f[1],req.array.t=g[0]+" "+g[1],req.array.tz=g[2],req.array.screen=getScreen(),req.array.sid=options.sid||null,cookie("__ghostUserID")?req.array.uid=cookie("__ghostUserID"):(req.array.uid=[(new Date).valueOf(),(1e9*Math.random()).toFixed()].join(""),cookie("__ghostUserID",req.array.uid,{path:window.location.pathname}));for(var i in req.array)req.array.hasOwnProperty(i)&&(req.str+=encodeURIComponent(i)+"="+encodeURIComponent(req.array[i])+"&");req.str=req.str.substr(0,req.str.length-1),cookie("__ghostFirstVisit")||cookie("__ghostFirstVisit",req.array.t,{path:window.location.pathname}),cookie("__ghostLastVisit",req.array.t,{path:window.location.pathname}),req.path.length&&send(req.path,req.str),"function"==typeof a?a(req.array):"function"==typeof options.callback&&options.callback(req.array)},this.push()}function Creator(a,b){return"function"==typeof a?(b=a,a={}):a=a||{},a.callback=b,new Ghost(a)}"function"==typeof define&&define.amd?define([],function(){return Creator}):"undefined"!=typeof module&&module.exports?module.exports=Creator:this.ghost=Creator}.call(this);
